@(generator: com.linkedin.sleipnir.generator.types.UnionTypeGenerator)

@import _root_.scala.collection.JavaConverters._
@import _root_.com.linkedin.data.schema.DataSchema.Type
@import _root_.com.linkedin.sleipnir.generator.types.TypeGeneratorFactory
@import _root_.com.linkedin.sleipnir.generator.types.TypeGenerator

package @(generator.name.packageName)

import com.linkedin.data.DataMap
import com.linkedin.data.schema.UnionDataSchema
import com.linkedin.data.template.DataTemplateUtil

import com.linkedin.sleipnir.data.ScalaUnionTemplate

import @(generator.name.shortClassName)._


class @(generator.name.shortClassName)(data: AnyRef) extends ScalaUnionTemplate(data, Schema) {

@for(typeGenerator <- generator.referencedGenerators.filterNot(_.schema.getType == Type.NULL)) {

  def is@(typeGenerator.name.shortClassName): Boolean = memberIs("@(typeGenerator.schema.getUnionMemberKey)")

  def as@(typeGenerator.name.shortClassName): Option[@(typeGenerator.name.externalClassName)] = maybeGet[@(typeGenerator.name.externalClassName)](@(generator.memberValName(typeGenerator)))

}

}


object @(generator.name.shortClassName) {

  private val SchemaJson = "@(generator.schemaJson)"

  private val Schema = DataTemplateUtil.parseSchema(SchemaJson).asInstanceOf[UnionDataSchema]

@for(typeGenerator <- generator.referencedGenerators.filterNot(_.schema.getType == Type.NULL)) {

  private val @(generator.memberValName(typeGenerator)) = Schema.getType("@(typeGenerator.schema.getUnionMemberKey)")

  def apply(value: @(typeGenerator.name.externalClassName)): @(generator.name.shortClassName) = {
    val union = new @(generator.name.shortClassName)(new DataMap())
    union.set(@(generator.memberValName(typeGenerator)), value)
    union
  }

}


  @if(generator.schema.contains("null")) {
    /**
     * This constant represents 'null' value of the union.
     */
    val NullInstance = new @(generator.name.shortClassName)(null)
  }

  def unapply(union: @(generator.name.shortClassName)): Option[Any] = {
    union.memberType match {

    @for(typeGenerator <- generator.referencedGenerators.filterNot(_.schema.getType == Type.NULL)) {
      case @(generator.memberValName(typeGenerator)) => union.as@(typeGenerator.name.shortClassName)
    }
      case _ => None
    }

  }


}